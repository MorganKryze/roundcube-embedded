FROM nginx:1.25-alpine as prod

# Remove default nginx page
RUN rm -rf /usr/share/nginx/html/*

# Copy your static site
COPY site/ /usr/share/nginx/html/


# Harden nginx config: disable server tokens, limit methods, add security headers
COPY docker/nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
# Healthcheck: check if the main page is served
HEALTHCHECK --interval=30s --timeout=5s --start-period=10s --retries=3 \
    CMD wget --spider -q http://localhost/ || exit 1
CMD ["nginx", "-g", "daemon off;"]
